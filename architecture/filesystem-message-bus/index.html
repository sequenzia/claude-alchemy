
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A monorepo combining Claude Code plugins and a real-time Task Manager application">
      
      
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../data-flow/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Filesystem Message Bus - Claude Alchemy</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#filesystem-message-bus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Claude Alchemy" class="md-header__button md-logo" aria-label="Claude Alchemy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Claude Alchemy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Filesystem Message Bus
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sequenzia/claude-alchemy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    sequenzia/claude-alchemy
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../task-manager/overview/" class="md-tabs__link">
          
  
  
  Task Manager

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../plugins/overview/" class="md-tabs__link">
          
  
  
  Plugins

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/setup/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Claude Alchemy" class="md-nav__button md-logo" aria-label="Claude Alchemy" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Claude Alchemy
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sequenzia/claude-alchemy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    sequenzia/claude-alchemy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Filesystem Message Bus
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Filesystem Message Bus
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-rationale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Rationale
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#producers-and-consumers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Producers and Consumers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-paths-and-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Paths and Locations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Paths and Locations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-directory-claudetaskslistid" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Directory (~/.claude/tasks/{listId}/)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-directory-claudesessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Directory (.claude/sessions/)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-format-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Format Contracts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Format Contracts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-json-idjson" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task JSON ({id}.json)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-pointer-execution_pointermd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Pointer (execution_pointer.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-context-execution_contextmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Context (execution_context.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-log-task_logmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Log (task_log.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progress-progressmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Progress (progress.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-file-lock" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lock File (.lock)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Lifecycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-active-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Active Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-archival" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Archival
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interrupted-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Interrupted Recovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-Time Data Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Time Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chokidar-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chokidar Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sse-event-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSE Event Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dual-invalidation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dual Invalidation Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Boundaries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-task-knowledge-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Task Knowledge Sharing
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tradeoffs-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tradeoffs and Limitations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Pages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Task Manager
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Task Manager
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../task-manager/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../task-manager/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../task-manager/real-time-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Real-Time System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../task-manager/components/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../task-manager/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Plugins
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Plugins
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/tools-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/sdd-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDD Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/sdd-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDD Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/conventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conventions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-rationale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Rationale
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#producers-and-consumers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Producers and Consumers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-paths-and-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Paths and Locations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Paths and Locations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-directory-claudetaskslistid" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Directory (~/.claude/tasks/{listId}/)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#session-directory-claudesessions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Directory (.claude/sessions/)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-format-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Format Contracts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="File Format Contracts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-json-idjson" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task JSON ({id}.json)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-pointer-execution_pointermd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Pointer (execution_pointer.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-context-execution_contextmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Context (execution_context.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-log-task_logmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Task Log (task_log.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#progress-progressmd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Progress (progress.md)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-file-lock" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lock File (.lock)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Lifecycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-active-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Active Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-archival" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Archival
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interrupted-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Interrupted Recovery
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-Time Data Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Time Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chokidar-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chokidar Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sse-event-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSE Event Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dual-invalidation-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dual Invalidation Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Boundaries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-task-knowledge-sharing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cross-Task Knowledge Sharing
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tradeoffs-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tradeoffs and Limitations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Related Pages
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<!-- docs/architecture/filesystem-message-bus.md -->
<h1 id="filesystem-message-bus">Filesystem Message Bus<a class="headerlink" href="#filesystem-message-bus" title="Permanent link">&para;</a></h1>
<p>Claude Alchemy's three subsystems -- the SDD plugin, the Tools plugin, and the Task Manager app -- communicate through a <strong>filesystem-as-message-bus</strong> pattern. There is no shared runtime code, no database, and no IPC. Every interaction between subsystems happens through reading and writing files on disk.</p>
<p>This architectural decision keeps each subsystem fully decoupled. The SDD plugin writes task JSON files and session artifacts; the Task Manager app watches those files for changes and renders them in a real-time Kanban UI. Neither subsystem imports code from the other, and neither needs to be running for the other to function.</p>
<h2 id="design-rationale">Design Rationale<a class="headerlink" href="#design-rationale" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Why the filesystem?</p>
<p>Claude Code plugins are markdown-only with no build step and no ability to expose HTTP endpoints or import shared libraries. The filesystem is the only communication channel available that works across all three subsystems without introducing runtime coupling.</p>
</div>
<p>The pattern offers several advantages:</p>
<ul>
<li><strong>Zero coupling</strong> -- Producers and consumers share no code, no types, and no protocol definitions beyond file format conventions</li>
<li><strong>Crash resilience</strong> -- All state is persisted to disk the moment it is created; no in-memory state to lose</li>
<li><strong>Debuggability</strong> -- Every message is a human-readable file you can inspect with <code>cat</code> or any text editor</li>
<li><strong>Replay</strong> -- Archived sessions can be re-read at any time for post-mortem analysis</li>
<li><strong>Simplicity</strong> -- No message broker, no serialization library, no connection management</li>
</ul>
<h2 id="producers-and-consumers">Producers and Consumers<a class="headerlink" href="#producers-and-consumers" title="Permanent link">&para;</a></h2>
<p>Every piece of data in the system has a clear producer (writer) and one or more consumers (readers). The filesystem path and file format serve as the implicit contract between them.</p>
<table>
<thead>
<tr>
<th>Data</th>
<th>Producer</th>
<th>Consumer</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>Task files (<code>{id}.json</code>)</td>
<td>Claude Code <code>TaskCreate</code>/<code>TaskUpdate</code>, <code>create-tasks</code> skill</td>
<td><code>taskService.ts</code> via <code>getTasks()</code>, Task Manager UI</td>
<td>JSON conforming to <code>Task</code> interface</td>
</tr>
<tr>
<td><code>execution_pointer.md</code></td>
<td><code>execute-tasks</code> skill (Step 5.5)</td>
<td><code>taskService.ts</code> via <code>getExecutionDir()</code></td>
<td>Plain text: single absolute path</td>
</tr>
<tr>
<td><code>execution_context.md</code></td>
<td><code>execute-tasks</code> + <code>task-executor</code> agents</td>
<td><code>taskService.ts</code> (as artifact), next <code>task-executor</code> agent</td>
<td>Markdown with 5 sections</td>
</tr>
<tr>
<td><code>task_log.md</code></td>
<td><code>execute-tasks</code> orchestrator (Step 7d)</td>
<td><code>taskService.ts</code> (as artifact)</td>
<td>Markdown table</td>
</tr>
<tr>
<td><code>progress.md</code></td>
<td><code>execute-tasks</code> orchestrator</td>
<td><code>taskService.ts</code> via <code>parseProgressMd()</code></td>
<td>Markdown with Status/Wave/Active Tasks</td>
</tr>
<tr>
<td><code>execution_plan.md</code></td>
<td><code>execute-tasks</code> (Step 5.5)</td>
<td><code>taskService.ts</code> (as artifact)</td>
<td>Markdown</td>
</tr>
<tr>
<td><code>.lock</code> file</td>
<td><code>execute-tasks</code> (Step 5.5)</td>
<td><code>execute-tasks</code> (stale detection, &gt;4h expiry)</td>
<td>Metadata: execution ID + timestamp</td>
</tr>
<tr>
<td><code>context-task-{id}.md</code></td>
<td><code>task-executor</code> agents (concurrent mode)</td>
<td><code>execute-tasks</code> orchestrator (wave merge)</td>
<td>Markdown with learnings</td>
</tr>
</tbody>
</table>
<pre class="mermaid"><code>graph TD
    subgraph Producers
        CT["create-tasks skill"]
        ET["execute-tasks skill"]
        TE["task-executor agents"]
    end

    subgraph "Filesystem (Message Bus)"
        TF["~/.claude/tasks/{listId}/{id}.json"]
        EP["~/.claude/tasks/{listId}/execution_pointer.md"]
        EC[".claude/sessions/__live_session__/execution_context.md"]
        TL[".claude/sessions/__live_session__/task_log.md"]
        PM[".claude/sessions/__live_session__/progress.md"]
        XP[".claude/sessions/__live_session__/execution_plan.md"]
        LK[".claude/sessions/__live_session__/.lock"]
    end

    subgraph Consumers
        TS["taskService.ts"]
        FW["fileWatcher.ts (Chokidar)"]
        SSE["SSE route (/api/events)"]
        UI["Task Manager UI"]
        TE2["Next task-executor agent"]
    end

    CT --&gt;|write JSON| TF
    ET --&gt;|write JSON via TaskUpdate| TF
    ET --&gt;|write pointer| EP
    ET --&gt;|initialize / merge| EC
    ET --&gt;|append rows| TL
    ET --&gt;|update status| PM
    ET --&gt;|save plan| XP
    ET --&gt;|create / remove| LK
    TE --&gt;|append learnings| EC

    TF --&gt;|read| TS
    EP --&gt;|resolve path| TS
    EC --&gt;|read artifacts| TS
    TL --&gt;|read artifacts| TS
    PM --&gt;|parse progress| TS
    XP --&gt;|read artifacts| TS
    EC --&gt;|read prior learnings| TE2

    TF --&gt;|detect change| FW
    PM --&gt;|detect change| FW
    EC --&gt;|detect change| FW
    FW --&gt;|emit event| SSE
    SSE --&gt;|stream| UI</code></pre>
<h2 id="file-paths-and-locations">File Paths and Locations<a class="headerlink" href="#file-paths-and-locations" title="Permanent link">&para;</a></h2>
<p>The bus uses two distinct directories on disk, each serving a different purpose.</p>
<h3 id="task-directory-claudetaskslistid">Task Directory (<code>~/.claude/tasks/{listId}/</code>)<a class="headerlink" href="#task-directory-claudetaskslistid" title="Permanent link">&para;</a></h3>
<p>This directory lives under the user's home directory and is managed by Claude Code's native task system. The <code>listId</code> is configured via <code>CLAUDE_CODE_TASK_LIST_ID</code> in <code>.claude/settings.json</code>.</p>
<div class="highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>~/.claude/tasks/{listId}/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├── 1.json                    # Task file
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>├── 2.json                    # Task file
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>├── 3.json                    # Task file
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>└── execution_pointer.md      # Absolute path to live session dir
</span></code></pre></div>
<h3 id="session-directory-claudesessions">Session Directory (<code>.claude/sessions/</code>)<a class="headerlink" href="#session-directory-claudesessions" title="Permanent link">&para;</a></h3>
<p>This directory lives within the project repository (relative to the working directory) and holds execution artifacts for the current and past sessions.</p>
<div class="highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>.claude/sessions/
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>├── __live_session__/          # Current active session
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>│   ├── .lock                  # Concurrency guard
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>│   ├── execution_plan.md      # Saved execution plan
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>│   ├── execution_context.md   # Shared learnings across tasks
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>│   ├── task_log.md            # Row-per-task result log
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>│   ├── progress.md            # Real-time wave/task progress
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>│   ├── context-task-5.md      # Per-task context (concurrent mode, temporary)
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>│   ├── context-task-6.md      # Per-task context (concurrent mode, temporary)
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>│   └── tasks/                 # Archived completed task JSONs
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>│       ├── 1.json
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>│       └── 2.json
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>├── user-auth-20260205-143022/ # Archived session
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>│   ├── execution_plan.md
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>│   ├── execution_context.md
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>│   ├── task_log.md
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>│   ├── progress.md
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>│   ├── session_summary.md
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>│   ├── .lock
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>│   └── tasks/
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>└── interrupted-20260206-091500/  # Recovered interrupted session
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    └── ...
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">The execution pointer bridges two directories</p>
<p>The <code>execution_pointer.md</code> file in the task directory contains the <strong>absolute path</strong> to <code>.claude/sessions/__live_session__/</code>. This is the only cross-reference between the two directory trees. The Task Manager reads the pointer to locate session artifacts.</p>
</div>
<h2 id="file-format-contracts">File Format Contracts<a class="headerlink" href="#file-format-contracts" title="Permanent link">&para;</a></h2>
<p>Each file type has a specific format that producers must write and consumers must parse. These formats are the implicit API contracts of the message bus.</p>
<h3 id="task-json-idjson">Task JSON (<code>{id}.json</code>)<a class="headerlink" href="#task-json-idjson" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">~/.claude/tasks/claude-alchemy/1.json</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;subject&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Implement user authentication middleware&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Add JWT-based auth middleware to the API layer...&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">&quot;blocks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="p">],</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="nt">&quot;blockedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">&quot;activeForm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="nt">&quot;complexity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;M&quot;</span><span class="p">,</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">&quot;task_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-auth&quot;</span><span class="p">,</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="nt">&quot;spec_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SPEC-user-auth.md&quot;</span><span class="p">,</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nt">&quot;source_section&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Section 2&quot;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>The consumer (<code>parseTask()</code> in <code>taskService.ts</code>) applies defensive normalization:</p>
<ul>
<li>Coerces <code>id</code> to string (accepts number or string)</li>
<li>Defaults <code>status</code> to <code>"pending"</code> if invalid</li>
<li>Ensures <code>blocks</code> and <code>blockedBy</code> are string arrays</li>
<li>Defaults <code>description</code> to empty string</li>
<li>Rejects tasks with no <code>subject</code> field</li>
</ul>
<p>Valid <code>status</code> values: <code>pending</code>, <code>in_progress</code>, <code>completed</code></p>
<h3 id="execution-pointer-execution_pointermd">Execution Pointer (<code>execution_pointer.md</code>)<a class="headerlink" href="#execution-pointer-execution_pointermd" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">~/.claude/tasks/claude-alchemy/execution_pointer.md</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>/Users/sequenzia/dev/repos/my-project/.claude/sessions/__live_session__/
</span></code></pre></div>
<p>A single line containing the absolute path to the live session directory. The consumer (<code>resolveExecutionDir()</code> in <code>taskService.ts</code>) validates the path:</p>
<ol>
<li>Resolves the path to an absolute form</li>
<li>Checks that the resolved path is under <code>$HOME</code> using <code>path.relative()</code></li>
<li>Returns <code>null</code> if the path escapes the home directory (path traversal guard)</li>
</ol>
<h3 id="execution-context-execution_contextmd">Execution Context (<code>execution_context.md</code>)<a class="headerlink" href="#execution-context-execution_contextmd" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">.claude/sessions/__live_session__/execution_context.md</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gh"># Execution Context</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="gu">## Project Patterns</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">-</span><span class="w"> </span>TypeScript strict mode throughout
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">-</span><span class="w"> </span>Barrel exports in each module directory
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">-</span><span class="w"> </span>Error handling at service boundaries only
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="gu">## Key Decisions</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="k">-</span><span class="w"> </span>Chose Zod over io-ts for runtime validation
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="k">-</span><span class="w"> </span>API routes use middleware chain pattern
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="gu">## Known Issues</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="k">-</span><span class="w"> </span>Test runner requires Node 18+ for fetch support
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="gu">## File Map</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="k">-</span><span class="w"> </span>src/lib/auth.ts — JWT verification and token refresh
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="k">-</span><span class="w"> </span>src/middleware.ts — Express middleware chain
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="gu">## Task History</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="gu">### Task [1]: Implement auth middleware - PASS</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="k">-</span><span class="w"> </span>Files modified: src/middleware.ts, src/lib/auth.ts
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="k">-</span><span class="w"> </span>Key learnings: Project uses barrel exports, middleware chain pattern
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="k">-</span><span class="w"> </span>Issues encountered: None
</span></code></pre></div>
<p>The five sections are populated incrementally. Task executors read the context at the start of their run and append to it after completion. In concurrent mode, agents write to separate <code>context-task-{id}.md</code> files, and the orchestrator merges them into the shared context after each wave.</p>
<h3 id="task-log-task_logmd">Task Log (<code>task_log.md</code>)<a class="headerlink" href="#task-log-task_logmd" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">.claude/sessions/__live_session__/task_log.md</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="gh"># Task Execution Log</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>| Task ID | Subject | Status | Attempts | Duration | Token Usage |
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>|---------|---------|--------|----------|----------|-------------|
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>| 1 | Implement auth middleware | PASS | 1/3 | 2m 34s | N/A |
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>| 2 | Add rate limiting | PARTIAL | 2/3 | 5m 12s | N/A |
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>| 3 | Create user endpoints | FAIL | 3/3 | 8m 45s | N/A |
</span></code></pre></div>
<p>Each row is appended as a task completes or exhausts retries. The orchestrator writes this file; task executors do not.</p>
<h3 id="progress-progressmd">Progress (<code>progress.md</code>)<a class="headerlink" href="#progress-progressmd" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">.claude/sessions/__live_session__/progress.md</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gh"># Execution Progress</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Status: Executing
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Wave: 2 of 4
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>Max Parallel: 5
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>Updated: 2026-02-05T14:35:22Z
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="gu">## Active Tasks</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">-</span><span class="w"> </span>[5] Add input validation — Phase 2 — Implementing
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">-</span><span class="w"> </span>[6] Create error handler — Phase 3 — Verifying
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="gu">## Completed This Session</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="k">-</span><span class="w"> </span>[1] Implement auth middleware — PASS (2m 34s)
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="k">-</span><span class="w"> </span>[2] Add rate limiting — PASS (3m 12s)
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="k">-</span><span class="w"> </span>[3] Create user endpoints — PASS (4m 5s)
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="k">-</span><span class="w"> </span>[4] Set up database schema — PASS (1m 48s)
</span></code></pre></div>
<p>The Task Manager parses this file via <code>parseProgressMd()</code> in <code>taskService.ts</code>, which extracts:</p>
<ul>
<li><code>status</code> -- Current execution state (Initializing, Executing, Complete)</li>
<li><code>wave</code> / <code>totalWaves</code> -- Current and total wave numbers</li>
<li><code>maxParallel</code> -- Configured concurrency limit</li>
<li><code>activeTasks</code> -- Array of <code>{ id, subject, phase }</code> from the Active Tasks section</li>
<li><code>completedTasks</code> -- Array of <code>{ id, subject, result }</code> from the Completed section</li>
</ul>
<h3 id="lock-file-lock">Lock File (<code>.lock</code>)<a class="headerlink" href="#lock-file-lock" title="Permanent link">&para;</a></h3>
<div class="highlight"><span class="filename">.claude/sessions/__live_session__/.lock</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>task_execution_id: user-auth-20260205-143022
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>timestamp: 2026-02-05T14:30:22Z
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>pid: orchestrator
</span></code></pre></div>
<p>The lock prevents concurrent execution sessions. The <code>execute-tasks</code> skill checks for this file before starting:</p>
<ul>
<li><strong>Lock exists, age &lt; 4 hours</strong> -- Prompts the user to force-start or cancel</li>
<li><strong>Lock exists, age &gt;= 4 hours</strong> -- Treats as stale, deletes it, and proceeds</li>
<li><strong>No lock</strong> -- Proceeds normally</li>
</ul>
<p>The lock is archived along with all other session files when the session completes.</p>
<h2 id="session-lifecycle">Session Lifecycle<a class="headerlink" href="#session-lifecycle" title="Permanent link">&para;</a></h2>
<p>A session progresses through four distinct phases. Each transition is driven by filesystem operations.</p>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; Creation: execute-tasks Step 5.5
    Creation --&gt; Active: User confirms plan
    Active --&gt; Active: task-executor reads/writes artifacts
    Active --&gt; Archival: All tasks processed (Step 8)
    Archival --&gt; [*]: Session complete

    Active --&gt; Interrupted: Process killed / crash
    Interrupted --&gt; Recovery: Next execute-tasks invocation
    Recovery --&gt; Creation: Stale files archived, tasks reset</code></pre>
<h3 id="1-creation">1. Creation<a class="headerlink" href="#1-creation" title="Permanent link">&para;</a></h3>
<p>Triggered by <code>execute-tasks</code> Step 5.5 after the user confirms the execution plan.</p>
<ol>
<li><strong>Stale session check</strong> -- If <code>__live_session__/</code> contains leftover files, archive them to <code>interrupted-{YYYYMMDD-HHMMSS}/</code></li>
<li><strong>Task recovery</strong> -- Any tasks left as <code>in_progress</code> from the interrupted session are reset to <code>pending</code></li>
<li><strong>Concurrency guard</strong> -- Check for <code>.lock</code> file; enforce the single-session invariant</li>
<li><strong>Session ID generation</strong> (three-tier):<ul>
<li><code>--task-group</code> flag provided: <code>{task_group}-{YYYYMMDD}-{HHMMSS}</code></li>
<li>All open tasks share a <code>task_group</code>: <code>{task_group}-{YYYYMMDD}-{HHMMSS}</code></li>
<li>Fallback: <code>exec-session-{YYYYMMDD}-{HHMMSS}</code></li>
</ul>
</li>
<li><strong>File creation</strong> -- <code>.lock</code>, <code>execution_plan.md</code>, <code>execution_context.md</code> (template), <code>task_log.md</code> (headers), <code>progress.md</code> (initial status), <code>tasks/</code> directory</li>
<li><strong>Pointer creation</strong> -- <code>execution_pointer.md</code> written to <code>~/.claude/tasks/{listId}/</code> with the absolute path to <code>__live_session__/</code></li>
</ol>
<h3 id="2-active-execution">2. Active Execution<a class="headerlink" href="#2-active-execution" title="Permanent link">&para;</a></h3>
<p>The session is active while the orchestrator runs the execution loop (Step 7).</p>
<ul>
<li><strong>Orchestrator writes</strong>: <code>task_log.md</code> (append per task), <code>progress.md</code> (update per wave/task), task JSON archives to <code>tasks/</code></li>
<li><strong>Task executors read</strong>: <code>execution_context.md</code> (prior learnings), skill references</li>
<li><strong>Task executors write</strong>: <code>context-task-{id}.md</code> (concurrent mode) or <code>execution_context.md</code> (sequential mode)</li>
<li><strong>Orchestrator merges</strong>: After each wave, <code>context-task-{id}.md</code> files are merged into <code>execution_context.md</code> and deleted</li>
<li><strong>Task Manager watches</strong>: Chokidar detects changes to JSON files and session artifacts, triggers SSE events</li>
</ul>
<h3 id="3-archival">3. Archival<a class="headerlink" href="#3-archival" title="Permanent link">&para;</a></h3>
<p>When all tasks have been processed (Step 8):</p>
<ol>
<li><code>progress.md</code> is updated with final status (<code>Status: Complete</code>)</li>
<li><code>session_summary.md</code> is written to <code>__live_session__/</code></li>
<li>All contents of <code>__live_session__/</code> (including <code>.lock</code>) are moved to <code>.claude/sessions/{task_execution_id}/</code></li>
<li><code>__live_session__/</code> is left as an empty directory</li>
<li><code>execution_pointer.md</code> continues to point to <code>__live_session__/</code> (now empty)</li>
</ol>
<h3 id="4-interrupted-recovery">4. Interrupted Recovery<a class="headerlink" href="#4-interrupted-recovery" title="Permanent link">&para;</a></h3>
<p>If a session is interrupted (process killed, crash, timeout), the next invocation of <code>execute-tasks</code> detects the stale state:</p>
<ol>
<li>Finds files remaining in <code>__live_session__/</code></li>
<li>Archives them to <code>.claude/sessions/interrupted-{YYYYMMDD-HHMMSS}/</code></li>
<li>Cross-references <code>task_log.md</code> (if present) to identify tasks from the interrupted session</li>
<li>Resets those <code>in_progress</code> tasks back to <code>pending</code> via <code>TaskUpdate</code></li>
<li>Proceeds with a fresh session</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">No automatic re-execution</p>
<p>Interrupted recovery resets task statuses but does not automatically re-execute tasks. The user must invoke <code>execute-tasks</code> again to resume work. Tasks that were completed before the interruption remain completed.</p>
</div>
<h2 id="real-time-data-flow">Real-Time Data Flow<a class="headerlink" href="#real-time-data-flow" title="Permanent link">&para;</a></h2>
<p>The Task Manager app observes filesystem changes in real time through a Chokidar-to-SSE pipeline. This is how the Kanban board updates automatically as the <code>execute-tasks</code> skill runs.</p>
<pre class="mermaid"><code>sequenceDiagram
    participant ET as execute-tasks skill
    participant FS as Filesystem
    participant CK as Chokidar (300ms poll)
    participant SSE as SSE Route (/api/events)
    participant Hook as useSSE Hook
    participant TQ as TanStack Query
    participant SC as Server Components
    participant UI as Browser UI

    ET-&gt;&gt;FS: Write {id}.json (TaskUpdate)
    ET-&gt;&gt;FS: Update progress.md
    CK-&gt;&gt;FS: Detect change (polling)
    CK-&gt;&gt;SSE: Emit task:updated / execution:updated
    SSE-&gt;&gt;Hook: Stream SSE event
    Hook-&gt;&gt;TQ: Invalidate query cache
    Hook-&gt;&gt;SC: router.refresh()
    TQ-&gt;&gt;UI: Re-render with fresh data
    SC-&gt;&gt;UI: Re-render server component</code></pre>
<h3 id="chokidar-configuration">Chokidar Configuration<a class="headerlink" href="#chokidar-configuration" title="Permanent link">&para;</a></h3>
<p>The <code>FileWatcher</code> singleton in <code>fileWatcher.ts</code> is configured with:</p>
<ul>
<li><strong>Polling interval</strong>: 300ms (<code>usePolling: true, interval: 300</code>)</li>
<li><strong>Watch depth</strong>: 2 levels from <code>~/.claude/tasks/</code></li>
<li><strong>Ignore initial</strong>: Does not fire events for files that exist when the watcher starts</li>
<li><strong>HMR safety</strong>: Uses <code>globalThis</code> singleton pattern to survive Next.js hot module replacement</li>
</ul>
<div class="highlight"><span class="filename">apps/task-manager/src/lib/fileWatcher.ts</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">watcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">watch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">basePath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nx">persistent</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="nx">ignoreInitial</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nx">usePolling</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nx">interval</span><span class="o">:</span><span class="w"> </span><span class="kt">300</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="nx">depth</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="p">})</span>
</span></code></pre></div>
<p>The watcher emits two event types:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Trigger</th>
<th>Payload</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>taskEvent</code></td>
<td><code>.json</code> file added, changed, or deleted</td>
<td><code>{ type, taskListId, taskId, task? }</code></td>
</tr>
<tr>
<td><code>executionEvent</code></td>
<td><code>.md</code> or <code>.txt</code> file changed in a watched execution dir</td>
<td><code>{ type: 'execution:updated', taskListId }</code></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Execution directory watching is dynamic</p>
<p>The watcher does not automatically monitor session directories. When the SSE route receives a connection for a <code>taskListId</code>, it calls <code>fileWatcher.watchExecutionDir(taskListId, execDir)</code> to start watching the resolved execution directory. This avoids watching directories that do not exist yet.</p>
</div>
<h3 id="sse-event-types">SSE Event Types<a class="headerlink" href="#sse-event-types" title="Permanent link">&para;</a></h3>
<p>The SSE route at <code>/api/events</code> streams four event types to the browser:</p>
<table>
<thead>
<tr>
<th>SSE Event</th>
<th>Source</th>
<th>Consumer Action</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>task:created</code></td>
<td>New <code>.json</code> file detected</td>
<td>Invalidate task list + task queries, refresh server components</td>
</tr>
<tr>
<td><code>task:updated</code></td>
<td><code>.json</code> file content changed</td>
<td>Invalidate task list + task queries, refresh server components</td>
</tr>
<tr>
<td><code>task:deleted</code></td>
<td><code>.json</code> file removed</td>
<td>Invalidate task list + task queries, refresh server components</td>
</tr>
<tr>
<td><code>execution:updated</code></td>
<td><code>.md</code> file changed in session dir</td>
<td>Invalidate execution context query, refresh server components</td>
</tr>
</tbody>
</table>
<h3 id="dual-invalidation-strategy">Dual Invalidation Strategy<a class="headerlink" href="#dual-invalidation-strategy" title="Permanent link">&para;</a></h3>
<p>When the <code>useSSE</code> hook receives an event, it performs <strong>two</strong> invalidation actions:</p>
<ol>
<li><strong>TanStack Query cache invalidation</strong> -- Forces client-side queries to refetch fresh data from the API routes, which in turn read the filesystem</li>
<li><strong><code>router.refresh()</code></strong> -- Forces Next.js to re-run Server Components, which fetch data directly from <code>taskService.ts</code></li>
</ol>
<p>This dual approach ensures both the client-side cache and the server-rendered HTML stay in sync with the filesystem.</p>
<h2 id="security-boundaries">Security Boundaries<a class="headerlink" href="#security-boundaries" title="Permanent link">&para;</a></h2>
<p>The filesystem bus requires security checks at the consumer side to prevent path traversal and data corruption.</p>
<table>
<thead>
<tr>
<th>Check</th>
<th>Location</th>
<th>Mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execution pointer path traversal</td>
<td><code>resolveExecutionDir()</code> in <code>taskService.ts</code></td>
<td>Uses <code>path.relative(home, resolved)</code> to ensure the pointer target stays under <code>$HOME</code>. Returns <code>null</code> if the relative path starts with <code>..</code></td>
</tr>
<tr>
<td>List ID validation</td>
<td>API routes</td>
<td>Rejects <code>listId</code> values containing <code>..</code> or <code>/</code></td>
</tr>
<tr>
<td>Task JSON normalization</td>
<td><code>parseTask()</code> in <code>taskService.ts</code></td>
<td>Defaults invalid status to <code>pending</code>, coerces arrays, requires <code>subject</code> field, converts <code>id</code> to string</td>
</tr>
<tr>
<td>Concurrency guard</td>
<td><code>.lock</code> file in <code>__live_session__/</code></td>
<td>Prevents multiple <code>execute-tasks</code> sessions from writing to the same session directory simultaneously</td>
</tr>
</tbody>
</table>
<div class="admonition danger">
<p class="admonition-title">Trust boundary</p>
<p>The filesystem bus trusts that producers write well-formed data. There is no schema validation layer between the plugin (producer) and the Task Manager (consumer) beyond the defensive parsing in <code>parseTask()</code>. If a plugin writes malformed JSON, the task is silently skipped.</p>
</div>
<h2 id="cross-task-knowledge-sharing">Cross-Task Knowledge Sharing<a class="headerlink" href="#cross-task-knowledge-sharing" title="Permanent link">&para;</a></h2>
<p>The <code>execution_context.md</code> file is the mechanism that allows later tasks to learn from earlier ones. It acts as a persistent, append-only knowledge base within a session.</p>
<pre class="mermaid"><code>graph LR
    subgraph "Wave 1"
        T1["Task 1&lt;br/&gt;executor"]
        T2["Task 2&lt;br/&gt;executor"]
    end

    subgraph "Wave 2"
        T3["Task 3&lt;br/&gt;executor"]
        T4["Task 4&lt;br/&gt;executor"]
    end

    CTX["execution_context.md"]
    C1["context-task-1.md"]
    C2["context-task-2.md"]
    C3["context-task-3.md"]
    C4["context-task-4.md"]

    CTX --&gt;|snapshot before wave 1| T1
    CTX --&gt;|snapshot before wave 1| T2
    T1 --&gt;|write learnings| C1
    T2 --&gt;|write learnings| C2
    C1 --&gt;|merge after wave 1| CTX
    C2 --&gt;|merge after wave 1| CTX
    CTX --&gt;|snapshot before wave 2| T3
    CTX --&gt;|snapshot before wave 2| T4
    T3 --&gt;|write learnings| C3
    T4 --&gt;|write learnings| C4
    C3 --&gt;|merge after wave 2| CTX
    C4 --&gt;|merge after wave 2| CTX</code></pre>
<p><strong>Concurrency safety</strong>: Within a wave, agents write to isolated <code>context-task-{id}.md</code> files rather than the shared <code>execution_context.md</code>. The orchestrator merges these files between waves. This prevents write contention when multiple agents run in parallel.</p>
<p><strong>Cross-session inheritance</strong>: When a new execution session starts, the orchestrator looks for the most recent archived session in <code>.claude/sessions/</code> and merges its learnings (Project Patterns, Key Decisions, Known Issues, File Map) into the fresh context. Task History entries are compacted after 10 entries to prevent unbounded growth.</p>
<h2 id="tradeoffs-and-limitations">Tradeoffs and Limitations<a class="headerlink" href="#tradeoffs-and-limitations" title="Permanent link">&para;</a></h2>
<div class="admonition question">
<p class="admonition-title">When does this pattern break down?</p>
</div>
<p><strong>Latency</strong>: The 300ms Chokidar polling interval introduces up to 300ms of latency between a file write and the UI update. This is acceptable for a development tool but would not suit sub-second real-time requirements.</p>
<p><strong>No guaranteed delivery</strong>: If the Task Manager is not running when a file changes, the change is not queued. The next page load will read the current state from disk, so data is never lost, but transient events (such as a task briefly entering <code>in_progress</code> before completing) may not be observed.</p>
<p><strong>No schema enforcement</strong>: The file formats are conventions, not enforced schemas. A producer writing an unexpected field or missing a required one will cause silent failures or fallback behavior in the consumer.</p>
<p><strong>Single-machine only</strong>: The filesystem bus assumes all subsystems run on the same machine and can access the same paths. There is no support for distributed or networked operation.</p>
<p><strong>Concurrency limitations</strong>: Only one <code>execute-tasks</code> session can run at a time per project, enforced by the <code>.lock</code> file. Multiple Task Manager instances can read simultaneously (read-only consumers), but multiple concurrent writers would require additional coordination.</p>
<h2 id="related-pages">Related Pages<a class="headerlink" href="#related-pages" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../task-manager/overview/">Task Manager Architecture</a> -- How the Next.js app consumes filesystem events</li>
<li><a href="../../plugins/sdd-plugin/">SDD Plugin</a> -- The plugin that produces most of the bus traffic</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>